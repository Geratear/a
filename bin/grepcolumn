#!/usr/bin/env python3
import click
from functools import reduce

@click.command()
@click.option('-d', '--delimiter', default=',', help='Set dilimiter')
@click.option('-t', '--tab', default=10, help='Set tab length')
@click.argument('file',type=click.File('r'))
@click.argument('fields')
def grepcolumn(file, delimiter, fields, tab):
    '''
    echo 'name=Jack,sex=male,job=coder' | grepcolumn - 'name,job,sex'
    '''
    fields = fields.split(',')
    print(reduce(lambda x,y: x+'\t'+y, fields).expandtabs(tab))
    print('-'*tab*len(fields))
    for line in file:
        data = {}
        for item in line.strip().split(delimiter):
            k,v = item.split('=')
            k = k.strip()
            if k in fields:
                data[k]=v
        buffer = ''
        for k in fields:
            buffer += data.get(k, '')+'\t'
        print(buffer.expandtabs(tab))

grepcolumn()
